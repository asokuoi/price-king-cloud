{% extends "admin/base.html" %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <h2 class="mb-0 fw-bold">ğŸ“Š ç‡Ÿé‹æˆ°æƒ…å®¤</h2>
        <small class="text-muted">æµé‡ç›£æ§ x ç•°å¸¸æŠ“é¬¼</small>
    </div>
    <div class="text-end">
        <span class="badge bg-dark p-2">æ•¸æ“šæ›´æ–°ï¼šå³æ™‚</span>
    </div>
</div>

<div class="row g-3 mb-4">
    <div class="col-md-3">
        <div class="card border-0 shadow-sm h-100" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h6 class="mb-1 opacity-75">ğŸ”¥ ä»Šæ—¥æœå°‹ç†±åº¦</h6>
                        <h2 class="mb-0 fw-bold">{{ data.today_search }}</h2>
                        <small class="opacity-50">æ¬¡æŸ¥è©¢è«‹æ±‚</small>
                    </div>
                    <i class="bi bi-activity fs-1 opacity-25"></i>
                </div>
            </div>
        </div>
    </div>

    <div class="col-md-3">
        <div class="card border-0 shadow-sm h-100" style="background: linear-gradient(135deg, #2af598 0%, #009efd 100%); color: white;">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h6 class="mb-1 opacity-75">ğŸ“¦ ç·šä¸Šå•†å“æ•¸</h6>
                        <h2 class="mb-0 fw-bold">{{ data.product_count }}</h2>
                        <small class="opacity-50">SKU</small>
                    </div>
                    <i class="bi bi-box-seam fs-1 opacity-25"></i>
                </div>
            </div>
        </div>
    </div>

    <div class="col-md-3">
        <div class="card border-0 shadow-sm h-100" style="background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 99%, #fecfef 100%); color: white;">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h6 class="mb-1 opacity-75">ğŸª åˆä½œé€šè·¯</h6>
                        <h2 class="mb-0 fw-bold">{{ data.store_count }}</h2>
                        <small class="opacity-50">å®¶</small>
                    </div>
                    <i class="bi bi-shop fs-1 opacity-25"></i>
                </div>
            </div>
        </div>
    </div>

    <div class="col-md-3">
        <div class="card border-0 shadow-sm h-100" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white;">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h6 class="mb-1 opacity-75">ğŸ‘¥ æŸ¥åƒ¹éƒ¨éšŠ</h6>
                        <h2 class="mb-0 fw-bold">{{ data.staff_count }}</h2>
                        <small class="opacity-50">äºº</small>
                    </div>
                    <i class="bi bi-people fs-1 opacity-25"></i>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-md-8 mb-4">
        <div class="card shadow-sm h-100">
            <div class="card-header bg-danger text-white d-flex justify-content-between align-items-center">
                <span class="fw-bold"><i class="bi bi-exclamation-triangle-fill me-2"></i> ç•°å¸¸å›å ±ç›£æ§</span>
                <span class="badge bg-white text-danger">åˆ·å–®é è­¦</span>
            </div>
            <div class="card-body p-0">
                <div class="alert alert-light border-bottom mb-0 small text-muted">
                    <i class="bi bi-info-circle me-1"></i> ç›£æ§æ¢ä»¶ï¼šåŒä¸€äººå°åŒä¸€å•†å“å–®æ—¥å›å ± <strong>â‰¥ 2æ¬¡</strong>
                </div>
                <div class="table-responsive">
                    <table class="table table-hover align-middle mb-0">
                        <thead class="table-light">
                            <tr>
                                <th>å“¡å·¥å§“å</th>
                                <th>å•†å“åç¨±</th>
                                <th>é€šè·¯</th>
                                <th class="text-center">æ¬¡æ•¸</th>
                                <th class="text-end">æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% if abnormal_list %}
                                {% for item in abnormal_list %}
                                <tr>
                                    <td class="fw-bold text-primary">{{ item.staff_name }}</td>
                                    <td>{{ item.product_name }}</td>
                                    <td><span class="badge bg-secondary">{{ item.chain_name }}</span></td>
                                    <td class="text-center">
                                        <span class="badge bg-danger rounded-pill">{{ item.cnt }}</span>
                                    </td>
                                    <td class="text-end">
                                        <a href="/admin/audit" class="btn btn-sm btn-outline-danger">
                                            <i class="bi bi-search"></i> ç¨½æ ¸
                                        </a>
                                    </td>
                                </tr>
                                {% endfor %}
                            {% else %}
                                <tr>
                                    <td colspan="5" class="text-center py-5 text-muted">
                                        <i class="bi bi-check-circle-fill text-success fs-1"></i>
                                        <p class="mt-2 mb-0">ä»Šæ—¥ç„¡ç•°å¸¸å›å ±</p>
                                    </td>
                                </tr>
                            {% endif %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <div class="col-md-4 mb-4">
        <div class="card shadow-sm h-100">
            <div class="card-header bg-info text-white">
                <span class="fw-bold"><i class="bi bi-search me-2"></i> å³æ™‚æœå°‹æµ (æœ€è¿‘10ç­†)</span>
            </div>
            <div class="card-body p-0">
                <ul class="list-group list-group-flush">
                    {% if recent_searches %}
                        {% for s in recent_searches %}
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            <div class="d-flex align-items-center">
                                <i class="bi bi-clock-history text-muted me-2 small"></i>
                                <span class="fw-bold text-dark">{{ s.keyword }}</span>
                            </div>
                            <span class="text-muted small" style="font-size: 0.8rem;">
                                {{ s.log_time.split(' ')[1][:5] }} </span>
                        </li>
                        {% endfor %}
                    {% else %}
                        <div class="text-center p-5 text-muted">
                            <i class="bi bi-hourglass-split fs-1"></i>
                            <p class="mt-2 mb-0">ç­‰å¾…ä»Šæ—¥æµé‡...</p>
                        </div>
                    {% endif %}
                </ul>
            </div>
            <div class="card-footer bg-light text-center small text-muted">
                é€™æ˜¯å¸‚å ´ç›®å‰çš„çœŸå¯¦éœ€æ±‚
            </div>
        </div>
    </div>
</div>
{% endblock %}